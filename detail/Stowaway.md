## Stowaway <https://github.com/ph4ntonn/Stowaway>
<!--auto_detail_badge_begin_0b490ffb61b26b45de3ea5d7dd8a582e-->
![Language](https://img.shields.io/badge/Language-Golang-blue)
![Author](https://img.shields.io/badge/Author-ph4ntonn-orange)
![GitHub stars](https://img.shields.io/github/stars/ph4ntonn/Stowaway.svg?style=flat&logo=github)
![Version](https://img.shields.io/badge/Version-V2.2-red)
![Time](https://img.shields.io/badge/Join-20210702-green)
<!--auto_detail_badge_end_fef74f2d7ea73fcc43ff78e05b1e7451-->

Stowawayæ˜¯ä¸€ä¸ªåˆ©ç”¨goè¯­è¨€ç¼–å†™ã€ä¸“ä¸ºæ¸—é€æµ‹è¯•å·¥ä½œè€…åˆ¶ä½œçš„å¤šçº§ä»£ç†å·¥å…·

ç”¨æˆ·å¯ä½¿ç”¨æ­¤ç¨‹åºå°†å¤–éƒ¨æµé‡é€šè¿‡å¤šä¸ªèŠ‚ç‚¹ä»£ç†è‡³å†…ç½‘ï¼Œçªç ´å†…ç½‘è®¿é—®é™åˆ¶ï¼Œæ„é€ æ ‘çŠ¶èŠ‚ç‚¹ç½‘ç»œï¼Œå¹¶è½»æ¾å®ç°ç®¡ç†åŠŸèƒ½

PS:è°¢è°¢å¤§å®¶çš„starï¼ŒåŒæ—¶æ¬¢è¿å¤§å®¶ä½¿ç”¨åæå‡ºé—®é¢˜&&Bug :kissing_heart:ã€‚

PPS:**è¯·åŠ¡å¿…åœ¨ä½¿ç”¨å‰è¯¦ç»†é˜…è¯»ä½¿ç”¨æ–¹æ³•åŠæ–‡æœ«çš„æ³¨æ„äº‹é¡¹**

> æ­¤å·¥å…·ä»…é™äºå®‰å…¨ç ”ç©¶å’Œæ•™å­¦ï¼Œç”¨æˆ·æ‰¿æ‹…å› ä½¿ç”¨æ­¤å·¥å…·è€Œå¯¼è‡´çš„æ‰€æœ‰æ³•å¾‹å’Œç›¸å…³è´£ä»»ï¼ ä½œè€…ä¸æ‰¿æ‹…ä»»ä½•æ³•å¾‹å’Œç›¸å…³è´£ä»»ï¼

## ç‰¹æ€§

- ç®¡ç†ç«¯æ›´åŠ å‹å¥½çš„äº¤äº’,æ”¯æŒå‘½ä»¤è¡¥å…¨/å†å²
- ä¸€ç›®äº†ç„¶çš„èŠ‚ç‚¹æ ‘ç®¡ç†
- ä¸°å¯Œçš„èŠ‚ç‚¹ä¿¡æ¯å±•ç¤º
- èŠ‚ç‚¹é—´æ­£å‘/åå‘è¿æ¥
- èŠ‚ç‚¹é—´æ”¯æŒé‡è¿
- èŠ‚ç‚¹é—´å¯é€šè¿‡socks5/httpä»£ç†è¿›è¡Œè¿æ¥
- èŠ‚ç‚¹é—´å¯é€šè¿‡sshéš§é“è¿æ¥
- èŠ‚ç‚¹é—´æµé‡å¯é€‰æ‹©TCP/HTTP/WS
- å¤šçº§socks5æµé‡ä»£ç†è½¬å‘,æ”¯æŒUDP/TCP,IPV4/IPV6
- èŠ‚ç‚¹æ”¯æŒsshè®¿é—®è¿œç¨‹ä¸»æœº
- è¿œç¨‹shell
- ä¸Šä¼ åŠä¸‹è½½æ–‡ä»¶
- ç«¯å£æœ¬åœ°/è¿œç¨‹æ˜ å°„
- èŠ‚ç‚¹å¯ç«¯å£å¤ç”¨
- è‡ªç”±å¼€å…³å„ç±»æœåŠ¡
- èŠ‚ç‚¹é—´ç›¸äº’è®¤è¯
- èŠ‚ç‚¹é—´æµé‡ä»¥TLS/AES-256-GCMè¿›è¡ŒåŠ å¯†
- ç›¸è¾ƒäºv1.0ï¼Œæ–‡ä»¶ä½“ç§¯å‡å°25%
- æ”¯æŒå„ç±»å¹³å°(Linux/Mac/Windows/MIPS/ARM)

## ç¼–è¯‘åŠæ¼”ç¤º

- ä½¿ç”¨`make`ç›´æ¥ç¼–è¯‘å¤šå¹³å°å®Œæ•´ç¨‹åºï¼Œæˆ–å‚çœ‹Makefileç¼–è¯‘ç‰¹å®šç¨‹åº
- ä¸æƒ³ç¼–è¯‘çš„ç›†æ²¹å¯ä»¥ç›´æ¥ç”¨[release](https://github.com/ph4ntonn/Stowaway/releases)ä¸‹ç¼–è¯‘å®Œæˆçš„ç¨‹åº
- æ¼”ç¤ºè§†é¢‘ï¼š[Youtube](https://www.youtube.com/watch?v=Lh5Q0RPWKMU&list=PLkbGxnHFIhA_g5XZtKzN4u-JXRq41L2g-)

## ä½¿ç”¨æ–¹æ³•

### è§’è‰²

Stowawayä¸€å…±åŒ…å«ä¸¤ç§è§’è‰²ï¼Œåˆ†åˆ«æ˜¯ï¼š
- `admin`    æ¸—é€æµ‹è¯•è€…ä½¿ç”¨çš„ä¸»æ§ç«¯
- `agent`    æ¸—é€æµ‹è¯•è€…éƒ¨ç½²çš„è¢«æ§ç«¯

### åè¯å®šä¹‰

- èŠ‚ç‚¹: æŒ‡admin || agent
- ä¸»åŠ¨æ¨¡å¼: æŒ‡å½“å‰æ“ä½œçš„èŠ‚ç‚¹ä¸»åŠ¨è¿æ¥å¦ä¸€ä¸ªèŠ‚ç‚¹
- è¢«åŠ¨æ¨¡å¼: æŒ‡å½“å‰æ“ä½œçš„èŠ‚ç‚¹ç›‘å¬æŸä¸ªç«¯å£ï¼Œç­‰å¾…å¦ä¸€ä¸ªèŠ‚ç‚¹è¿æ¥
- ä¸Šæ¸¸: æŒ‡å½“å‰æ“ä½œçš„èŠ‚ç‚¹ä¸å…¶çˆ¶èŠ‚ç‚¹ä¹‹é—´çš„æµé‡
- ä¸‹æ¸¸ï¼šæŒ‡å½“å‰æ“ä½œçš„èŠ‚ç‚¹ä¸å…¶**æ‰€æœ‰**å­èŠ‚ç‚¹ä¹‹é—´çš„æµé‡

### å‚æ•°è§£æ

- admin

```
å‚æ•°:
-l è¢«åŠ¨æ¨¡å¼ä¸‹çš„ç›‘å¬åœ°å€[ip]:<port>
-s èŠ‚ç‚¹é€šä¿¡åŠ å¯†å¯†é’¥,æ‰€æœ‰èŠ‚ç‚¹(admin&&agent)å¿…é¡»ä¸€è‡´
-c ä¸»åŠ¨æ¨¡å¼ä¸‹çš„ç›®æ ‡èŠ‚ç‚¹åœ°å€
--socks5-proxy socks5ä»£ç†æœåŠ¡å™¨åœ°å€
--socks5-proxyu socks5ä»£ç†æœåŠ¡å™¨ç”¨æˆ·å(å¯é€‰)
--socks5-proxyp socks5ä»£ç†æœåŠ¡å™¨å¯†ç (å¯é€‰)
--http-proxy httpä»£ç†æœåŠ¡å™¨åœ°å€
--down ä¸‹æ¸¸åè®®ç±»å‹,é»˜è®¤ä¸ºè£¸TCPæµé‡,å¯é€‰HTTP/WS
--tls-enable ä¸ºèŠ‚ç‚¹é€šä¿¡å¯ç”¨TLSï¼Œåœ¨å¯ç”¨TLSåï¼ŒAESåŠ å¯†å°†è¢«ç¦ç”¨
--domain æŒ‡å®šTLS SNIåŸŸåï¼Œè‹¥ä¸ºç©ºï¼Œé»˜è®¤ä¸ºç›®æ ‡èŠ‚ç‚¹åœ°å€
--heartbeat å¼€å¯å¿ƒè·³åŒ…
```

- agent

```
å‚æ•°:
-l è¢«åŠ¨æ¨¡å¼ä¸‹çš„ç›‘å¬åœ°å€[ip]:<port>
-s èŠ‚ç‚¹é€šä¿¡åŠ å¯†å¯†é’¥
-c ä¸»åŠ¨æ¨¡å¼ä¸‹çš„ç›®æ ‡èŠ‚ç‚¹åœ°å€
--socks5-proxy socks5ä»£ç†æœåŠ¡å™¨åœ°å€
--socks5-proxyu socks5ä»£ç†æœåŠ¡å™¨ç”¨æˆ·å(å¯é€‰)
--socks5-proxyp socks5ä»£ç†æœåŠ¡å™¨å¯†ç (å¯é€‰)
--http-proxy httpä»£ç†æœåŠ¡å™¨åœ°å€
--reconnect é‡è¿æ—¶é—´é—´éš”
--rehost ç«¯å£å¤ç”¨æ—¶å¤ç”¨çš„IPåœ°å€
--report ç«¯å£å¤ç”¨æ—¶å¤ç”¨çš„ç«¯å£å·
--up ä¸Šæ¸¸åè®®ç±»å‹,é»˜è®¤ä¸ºè£¸TCPæµé‡,å¯é€‰HTTP/WS
--down ä¸‹æ¸¸åè®®ç±»å‹,é»˜è®¤ä¸ºè£¸TCPæµé‡,å¯é€‰HTTP/WS
--cs è¿è¡Œå¹³å°çš„shellç¼–ç ç±»å‹ï¼Œé»˜è®¤ä¸ºutf-8ï¼Œå¯é€‰gbk
--tls-enable ä¸ºèŠ‚ç‚¹é€šä¿¡å¯ç”¨TLSï¼Œåœ¨å¯ç”¨TLSåï¼ŒAESåŠ å¯†å°†è¢«ç¦ç”¨
--domain æŒ‡å®šTLS SNIåŸŸåï¼Œè‹¥ä¸ºç©ºï¼Œé»˜è®¤ä¸ºç›®æ ‡èŠ‚ç‚¹åœ°å€
```

### å‚æ•°ç”¨æ³•

#### -l

æ­¤å‚æ•°admin&&agentç”¨æ³•ä¸€è‡´ï¼Œä»…ç”¨åœ¨è¢«åŠ¨æ¨¡å¼ä¸‹ 

è‹¥ä¸æŒ‡å®šIPåœ°å€ï¼Œåˆ™é»˜è®¤ç›‘å¬åœ¨`0.0.0.0`ä¸Š

- admin:  `./stowaway_admin -l 9999` or `./stowaway_admin -l 127.0.0.1:9999`

- agent:  `./stowaway_agent -l 9999`  or `./stowaway_agent -l 127.0.0.1:9999`

#### -s

æ­¤å‚æ•°admin&&agentç”¨æ³•ä¸€è‡´ï¼Œå¯ç”¨åœ¨ä¸»åŠ¨&&è¢«åŠ¨æ¨¡å¼ä¸‹

å¯é€‰ï¼Œè‹¥ä¸ºç©ºï¼Œåˆ™ä»£è¡¨é€šä¿¡ä¸è¢«åŠ å¯†ï¼Œåä¹‹åˆ™é€šä¿¡åŸºäºç”¨æˆ·æ‰€ç»™å‡ºçš„å¯†é’¥åŠ å¯†

- admin:  `./stowaway_admin -l 9999 -s 123`

- agent:  `./stowaway_agent -l 9999 -s 123`

#### -c

æ­¤å‚æ•°admin&&agentç”¨æ³•ä¸€è‡´ï¼Œä»…ç”¨åœ¨ä¸»åŠ¨æ¨¡å¼ä¸‹

ä»£è¡¨äº†å¸Œæœ›è¿æ¥åˆ°çš„èŠ‚ç‚¹çš„åœ°å€

- admin:  `./stowaway_admin -c 127.0.0.1:9999`

- agent:  `./stowaway_agent -c 127.0.0.1:9999`

#### --socks5-proxy/--socks5-proxyu/--socks5-proxyp/--http-proxy

è¿™å››ä¸ªå‚æ•°admin&&agentç”¨æ³•ä¸€è‡´ï¼Œä»…ç”¨åœ¨ä¸»åŠ¨æ¨¡å¼ä¸‹

`--socks5-proxy`ä»£è¡¨socks5ä»£ç†æœåŠ¡å™¨åœ°å€ï¼Œ`--socks5-proxyu`ä»¥åŠ`--socks5-proxyp`å¯é€‰

`--http-proxy`ä»£è¡¨httpä»£ç†æœåŠ¡å™¨åœ°å€,ä¸socks5ä½¿ç”¨æ–¹å¼ç›¸åŒ

æ— ç”¨æˆ·åå¯†ç ï¼š

- admin:  `./stowaway_admin -c 127.0.0.1:9999 --socks5-proxy xxx.xxx.xxx.xxx`

- agent:  `./stowaway_agent -c 127.0.0.1:9999 --socks5-proxy xxx.xxx.xxx.xxx`

æœ‰ç”¨æˆ·åå¯†ç :

- admin:  `./stowaway_admin -c 127.0.0.1:9999 --socks5-proxy xxx.xxx.xxx.xxx --socks5-proxyu xxx --socks5-proxyp xxx`

- agent:  `./stowaway_agent -c 127.0.0.1:9999 --socks5-proxy xxx.xxx.xxx.xxx --socks5-proxyu xxx --socks5-proxyp xxx`

#### --up/--down

è¿™ä¸¤ä¸ªå‚æ•°admin&&agentç”¨æ³•ä¸€è‡´ï¼Œå¯ç”¨åœ¨ä¸»åŠ¨&&è¢«åŠ¨æ¨¡å¼ä¸‹

ä½†æ³¨æ„adminä¸Šæ²¡æœ‰`--up`å‚æ•°

è¿™ä¸¤ä¸ªå‚æ•°å¯é€‰ï¼Œè‹¥ä¸ºç©ºï¼Œåˆ™ä»£è¡¨ä¸Š/ä¸‹æ¸¸æµé‡ä¸ºè£¸TCPæµé‡

è‹¥å¸Œæœ›ä¸Š/ä¸‹æ¸¸æµé‡ä¸ºHTTP/WSæµé‡ï¼Œè®¾ç½®æ­¤ä¸¤å‚æ•°ä¸º`http`æˆ–`ws`å³å¯

- admin:  `./stowaway_admin -c 127.0.0.1:9999 --down ws`

- agent:  `./stowaway_agent -c 127.0.0.1:9999 --up ws` or `./stowaway_agent -c 127.0.0.1:9999 --up ws --down ws`

**æ³¨æ„ä¸€ç‚¹ï¼Œå½“ä½ è®¾ç½®äº†æŸä¸€èŠ‚ç‚¹ä¸Š/ä¸‹æ¸¸ä¸ºTCP/HTTP/WSæµé‡åï¼Œä¸å…¶è¿æ¥çš„çˆ¶/å­èŠ‚ç‚¹çš„ä¸‹/ä¸Šæ¸¸æµé‡å¿…é¡»è®¾ç½®ä¸ºä¸€è‡´ï¼**

å¦‚ä¸‹

- admin:  `./stowaway_admin -c 127.0.0.1:9999 --down ws`

- agent:  `./stowaway_agent -l 9999 --up ws`

ä¸Šé¢è¿™ç§æƒ…å†µï¼Œagentå¿…é¡»è®¾ç½®`--up`ä¸ºwsï¼Œå¦åˆ™ä¼šå¯¼è‡´ç½‘ç»œå‡ºé”™

agenté—´ä¹Ÿä¸€æ ·

å‡è®¾agent-1æ­£åœ¨`127.0.0.1:10000`ç«¯å£ä¸Šç­‰å¾…å­èŠ‚ç‚¹çš„è¿æ¥ï¼Œå¹¶ä¸”è®¾ç½®äº†`--down ws`

é‚£ä¹ˆagent-2ä¹Ÿå¿…é¡»è®¾ç½®`--up`ä¸ºwsï¼Œå¦åˆ™ä¼šå¯¼è‡´ç½‘ç»œå‡ºé”™

- agent-2:  `./stowaway_agent -c 127.0.0.1:10000 --up ws`

#### --reconnect

æ­¤å‚æ•°ä»…ç”¨åœ¨agentï¼Œä¸”ä»…ç”¨åœ¨ä¸»åŠ¨æ¨¡å¼ä¸‹

å‚æ•°å¯é€‰ï¼Œè‹¥ä¸è®¾ç½®ï¼Œåˆ™ä»£è¡¨èŠ‚ç‚¹åœ¨ç½‘ç»œè¿æ¥æ–­å¼€åä¸ä¼šä¸»åŠ¨é‡è¿ï¼Œè‹¥è®¾ç½®ï¼Œåˆ™ä»£è¡¨èŠ‚ç‚¹ä¼šæ¯éš”x(ä½ è®¾ç½®çš„ç§’æ•°)ç§’å°è¯•é‡è¿è‡³çˆ¶èŠ‚ç‚¹

- admin:  `./stowaway_admin -l 9999`

- agent:  `./stowaway_agent -c 127.0.0.1:9999 --reconnect 10`

ä¸Šé¢è¿™ç§æƒ…å†µä¸‹ï¼Œä»£è¡¨å¦‚æœagentä¸adminä¹‹é—´çš„è¿æ¥æ–­å¼€ï¼Œagentä¼šæ¯éš”åç§’å°è¯•é‡è¿å›admin

agentä¹‹é—´ä¹Ÿä¸ä¸Šé¢æƒ…å†µä¸€è‡´

å¹¶ä¸”`--reconnect`å‚æ•°å¯ä»¥ä¸`--socks5-proxy`/`--socks5-proxyu`/`--socks5-proxyp`/`--http-proxy`ä¸€èµ·ä½¿ç”¨ï¼Œagentå°†ä¼šå‚ç…§å¯åŠ¨æ—¶çš„è®¾ç½®ï¼Œé€šè¿‡ä»£ç†å°è¯•é‡è¿

#### --rehost/--report

è¿™ä¸¤ä¸ªå‚æ•°æ¯”è¾ƒç‰¹åˆ«ï¼Œä»…ç”¨åœ¨agentç«¯ï¼Œè¯¦ç»†è¯·å‚è§ä¸‹æ–¹çš„ç«¯å£å¤ç”¨æœºåˆ¶

#### --cs

æ­¤å‚æ•°ä»…ç”¨åœ¨agentï¼Œå¯ç”¨åœ¨ä¸»åŠ¨&&è¢«åŠ¨æ¨¡å¼ä¸‹

ä¸»è¦æ—¨åœ¨è§£å†³'shell'åŠŸèƒ½ä¹±ç é—®é¢˜ï¼Œå½“ç”¨æˆ·å°†agentè¿è¡Œäºæ§åˆ¶å°ç¼–ç ä¸ºgbkçš„å¹³å°ä¸Š(ä¾‹å¦‚ä¸€èˆ¬æƒ…å†µä¸‹çš„Windows)å¹¶ä¸”åŒæ—¶adminè¿è¡Œäºæ§åˆ¶å°ç¼–ç ä¸ºutf-8çš„å¹³å°ä¸Šæ—¶ï¼Œè¯·åŠ¡å¿…å°†æ­¤å‚æ•°è®¾ç½®ä¸º'gbk'

- Windows: `./stowaway_agent -c 127.0.0.1:9999 -s 123 --cs gbk`

#### --tls-enable

è¿™ä¸¤ä¸ªå‚æ•°admin&&agentç”¨æ³•ä¸€è‡´ï¼Œå¯ç”¨åœ¨ä¸»åŠ¨&&è¢«åŠ¨æ¨¡å¼ä¸‹

é€šè¿‡è®¾ç½®æ­¤é€‰é¡¹ï¼Œå¯ä»¥å°†èŠ‚ç‚¹é—´æµé‡ä»¥TLSåŠ å¯†

ç¤ºä¾‹å¦‚ä¸‹
- admin: `./stowaway_admin -l 10000 --tls-enable -s 123`
- agent: `./stowaway_agent -c localhost:10000 --tls-enable -s 123`

æ³¨æ„ï¼Œå½“æ­¤å‚æ•°å¯ç”¨æ—¶ï¼ŒaesåŠ å¯†å°†è¢«é»˜è®¤ç¦ç”¨ï¼Œ-så‚æ•°å°†ä»…ç”¨äºèŠ‚ç‚¹é—´ç›¸äº’éªŒè¯&ç«¯å£å¤ç”¨åŠŸèƒ½

å¦å¤–ï¼Œå½“æ­¤å‚æ•°å¯ç”¨æ—¶ï¼Œ**è¯·ä¿è¯ç½‘ç»œä¸­æ¯ä¸€ä¸ªèŠ‚ç‚¹(åŒ…æ‹¬admin)éƒ½å¯ç”¨æ­¤å‚æ•°**

#### --domain

è¿™ä¸¤ä¸ªå‚æ•°admin&&agentç”¨æ³•ä¸€è‡´ï¼Œä»…å¯ç”¨åœ¨ä¸»åŠ¨æ¨¡å¼ä¸‹

é€šè¿‡è®¾ç½®æ­¤é€‰é¡¹ï¼Œå¯ä»¥è®¾ç½®å½“å‰æ­¤èŠ‚ç‚¹TLSåå•†æ—¶çš„SNIé€‰é¡¹

ç¤ºä¾‹å¦‚ä¸‹
- admin: `./stowaway_admin -l 10000 --tls-enable -s 123`
- agent: `./stowaway_agent -c xxx.xxx.xxx.xxx:10000 --tls-enable -s 123 --domain xxx.com`

æ³¨æ„ï¼Œæ­¤å‚æ•°å¯ç”¨å¿…é¡»é…åˆ--tls-enableå‚æ•°ï¼Œå¦åˆ™æ­¤å‚æ•°æ— æ•ˆ

#### --heartbeat

è¿™ä¸ªå‚æ•°ä»…ç”¨åœ¨adminç«¯ï¼Œå¯ç”¨åœ¨ä¸»åŠ¨&è¢«åŠ¨æ¨¡å¼ä¸‹

é€šè¿‡è®¾ç½®æ­¤é€‰é¡¹ï¼Œå¯ä»¥ä½¿adminæŒç»­å‘ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å‘é€å¿ƒè·³åŒ…ï¼Œä»è€Œåœ¨ä¸­é—´æœ‰åå‘ä»£ç†çš„æƒ…å†µä¸‹ç»´æŒé•¿é“¾æ¥

å‡è®¾adminå’Œagentä¸­æœ‰ç±»ä¼¼nginxçš„åå‘ä»£ç†è®¾å¤‡å°†8080ç«¯å£ä»£ç†è‡³8000ç«¯å£,ç¤ºä¾‹å¦‚ä¸‹ 
- admin: `./stowaway_admin -l 8000 --tls-enable -s 123 --down ws --heartbeat`
- agent: `./stowaway_agent -c xxx.xxx.xxx.xxx:8080 --tls-enable -s 123 --domain xxx.com --up ws`

## ç«¯å£å¤ç”¨æœºåˆ¶

å½“å‰Stowawayæä¾›åŸºäºSO_REUSEPORTå’ŒSO_REUSEADDRç‰¹æ€§çš„ç«¯å£å¤ç”¨åŠŸèƒ½åŠåŸºäºIPTABLESçš„ç«¯å£å¤ç”¨åŠŸèƒ½

- åœ¨linuxä¸‹å¯ä»¥å¤§éƒ¨åˆ†çš„åŠŸèƒ½ç«¯å£

- åœ¨windowsä¸‹ä¸å¯å¤ç”¨iisï¼Œrdpç«¯å£ï¼Œå¯ä»¥å¤ç”¨mysqlï¼ŒapacheæœåŠ¡çš„ç«¯å£

### å¤ç”¨æ–¹å¼

- SO_REUSEPORTå’ŒSO_REUSEADDRæ¨¡å¼

  å‡è®¾agentç«¯é‡‡ç”¨ç«¯å£å¤ç”¨æœºåˆ¶å¤ç”¨80ç«¯å£

  æ­¤æ—¶agentç«¯å¿…é¡»è®¾ç½®`--rehost`&&`--report`&&`-s`å‚æ•°

  - `--rehost`: ä»£è¡¨å¸Œæœ›å¤ç”¨çš„IPåœ°å€ï¼Œä¸å¯ä¸º0.0.0.0ï¼Œæ™®éåº”å½“æ˜¯ç½‘å¡çš„å¤–éƒ¨åœ°å€

  - `--report`: ä»£è¡¨å¸Œæœ›å¤ç”¨çš„ç«¯å£

  - `-s`: ä»£è¡¨é€šä¿¡å¯†é’¥

  **ä¸»è¦æ”¯æŒwindowsã€macç¯å¢ƒä¸‹çš„å¤ç”¨ï¼Œlinuxäº¦å¯ï¼Œä½†é™åˆ¶è¾ƒå¤š**
  
  - adminç«¯ï¼š`./stowaway_admin -c 192.168.0.105:80 -s 123`
  - agentç«¯ï¼š`./stowaway_agent  --report 80 --rehost 192.168.0.105 -s 123`


- IPTABLESæ¨¡å¼

  å‡è®¾agentç«¯é‡‡ç”¨ç«¯å£å¤ç”¨æœºåˆ¶å¤ç”¨22ç«¯å£

  æ­¤æ—¶agentç«¯å¿…é¡»è®¾ç½®`-l`&&`--report`&&`-s`å‚æ•°

  - `-l`: ä»£è¡¨æ— æ³•è¢«æ­£å¸¸è®¿é—®çš„ç«¯å£ï¼Œä¹Ÿå°±æ˜¯ä½ çœŸæ­£æƒ³è®©agentç›‘å¬å¹¶æ¥å—è¿æ¥çš„ç«¯å£

  - `--report`: ä»£è¡¨å¸Œæœ›å¤ç”¨çš„ç«¯å£

  - `-s`: ä»£è¡¨é€šä¿¡å¯†é’¥

  **ä»…æ”¯æŒlinuxç¯å¢ƒä¸‹çš„å¤ç”¨ï¼Œagentä¼šè‡ªåŠ¨ä¿®æ”¹IPTABLESï¼Œéœ€è¦rootæƒé™**

  - agentç«¯ï¼š `./stowaway_agent --report 22 -l 10000 -s 123`

    åœ¨agentå¯åŠ¨åï¼Œè¯·ä½¿ç”¨`script`ç›®å½•ä¸‹çš„`reuse.py`

    å…ˆè®¾ç½®SECRETçš„å€¼(SECRETçš„å€¼å°±æ˜¯åœ¨å¯åŠ¨å„ä¸ªèŠ‚ç‚¹æ—¶æ‰€è®¾ç½®çš„é€šä¿¡å¯†é’¥),

    ä¹‹åæ‰§è¡Œï¼š`python reuse.py --start --rhost xxx.xxx.xxx.xxx --rport xxx`

    - `--rhost`: ä»£è¡¨agentçš„åœ°å€

    - `--rport`: ä»£è¡¨è¢«å¤ç”¨çš„ç«¯å£,åœ¨æœ¬ä¾‹ä¸­åº”å½“ä¸º22

  - æ­¤æ—¶adminç«¯å°±å¯ä»¥è¿æ¥ï¼š`./stowaway_admin -c 192.168.0.105:22 -s 123`
  

### æ³¨æ„

- ä»¥ä¸Šæƒ…å†µåªæ˜¯åˆ—ä¸¾äº†adminä»¥åŠagentä¹‹é—´çš„è¿æ¥ï¼Œagentä¸agentä¹‹é—´çš„è¿æ¥äº¦åŒï¼Œå¹¶æ— å·®å¼‚

- å¦‚æœagentè¢«ctrl-cæˆ–è€…killå‘½ä»¤æ€æ­»ï¼Œç¨‹åºå°†ä¼šè‡ªåŠ¨æ¸…ç†iptablesè§„åˆ™ï¼Œä½†å¦‚æœè¢«kill -9 æ€æ­»ï¼Œåˆ™æ— æ³•è‡ªåŠ¨æ¸…é™¤

  æ•…è€Œä¸ºäº†é˜²æ­¢agentå¼‚å¸¸é€€å‡ºåï¼Œiptablesè§„åˆ™æ²¡æœ‰è¢«æ¸…ç†å¯¼è‡´è¢«å¤ç”¨çš„æœåŠ¡æ— æ³•è®¿é—®

  æ‰€ä»¥å½“éœ€è¦å…³é—­æ—¶ï¼Œéœ€è¿è¡Œï¼š`python reuse.py --stop --rhost xxx.xxx.xxx.xxx --rport xxx`

  å³å¯å…³é—­è½¬å‘è§„åˆ™ï¼Œä½¿å¾—åŸæœåŠ¡èƒ½å¤Ÿè¢«æ­£å¸¸è®¿é—®

- å¦‚æœä½¿ç”¨IPTABLESæ¨¡å¼ä¸‹çš„ç«¯å£å¤ç”¨æ¨¡å¼ï¼Œå°†ä¼šå¼ºåˆ¶ç›‘å¬åœ¨0.0.0.0ï¼Œæ— æ³•ç”±`-l`å‚æ•°æ¥æŒ‡å®šip

## å¦‚ä½•ç»„æˆå¤šçº§ç½‘ç»œï¼Ÿ

ä»ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹åˆ°ï¼Œåªæœ‰adminå’Œä¸€ä¸ªagentå‡ºåœº

è€Œå¤šçº§ç½‘ç»œæ‰æ˜¯æ ¸å¿ƒ

åœ¨stowawayä¸­ï¼Œç»„æˆå¤šçº§ç½‘ç»œéœ€è¦å€ŸåŠ©adminä¸­çš„`listen`ã€`connect`ã€ `sshtunnel`å‘½ä»¤æ¥å®ç°

ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­

- admin: `./stowaway_admin -l 9999 -s 123`

æ­¤æ—¶agent-1å·²ç»è¿ä¸Šadmin

- agent-1:  `./stowaway_agent -c 127.0.0.1:9999 -s 123`

 æ­¤æ—¶ç”¨æˆ·è¿˜æƒ³è¿æ¥agent-2ï¼Œå¦‚ä¸‹

- agent-2:  `./stowaway_agent -l 10000 -s 123`

é‚£ä¹ˆï¼Œæ­¤æ—¶ç”¨æˆ·å¯ä»¥é€šè¿‡admin,è¾“å…¥`use 0` -> `connect agent-2çš„IP:10000`æ¥å°†å…¶åŠ å…¥ç½‘ç»œï¼Œå¹¶æˆä¸ºagent-1çš„ä¸€ä¸ªå­èŠ‚ç‚¹

å‡å¦‚æ­¤æ—¶ç”¨æˆ·è¿˜å¸Œæœ›è¿å…¥ä¸€ä¸ªèŠ‚ç‚¹agent-3ï¼Œä½†æ˜¯é€šè¿‡agent-1æ— æ³•è®¿é—®agent-3

é‚£ä¹ˆï¼Œæ­¤æ—¶ç”¨æˆ·å¯ä»¥é€šè¿‡admin,è¾“å…¥`use 0` -> `listen` -> é€‰æ‹©`1.Normal Passive` -> è¾“å…¥`10001` ä»è€Œä½¿å¾—agent-1ç›‘å¬åœ¨10001ç«¯å£ä¸Šï¼Œå¹¶ç­‰å¾…å­èŠ‚ç‚¹çš„è¿æ¥

ç­‰adminæ“ä½œå®Œæˆåï¼Œagent-3å¯åŠ¨å¦‚ä¸‹

- agent-3: `./stowaway_agent -c 127.0.0.1:10001 -s 123`

å°±å¯ä»¥å°†agent-3ä½œä¸ºagent-1çš„å¦ä¸€ä¸ªå­èŠ‚ç‚¹åŠ å…¥ç½‘ç»œäº†

å…³äº`listen`ä»¥åŠ`sshtunnel`çš„è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥å‚çœ‹ä¸‹æ–¹çš„å‘½ä»¤è§£æ

## å¦‚ä½•é‡è¿ï¼Ÿ

Stowawayå½“å‰æ”¯æŒå¤šç§æ–¹å¼çš„é‡è¿ï¼Œç®€å•æ¦‚æ‹¬å¦‚ä¸‹

é¦–å…ˆï¼Œå½“çˆ¶èŠ‚ç‚¹æ‰çº¿åï¼Œåªæœ‰ä¸€ç§èŠ‚ç‚¹ä¼šä¸»åŠ¨é€€å‡ºï¼Œé‚£å°±æ˜¯å¯åŠ¨æ—¶ä¸ºä¸»åŠ¨æ¨¡å¼ä¸”æ²¡æœ‰è®¾ç½®é‡è¿çš„èŠ‚ç‚¹

å¦‚æœè®¾ç½®äº†é‡è¿ï¼Œé‚£ä¹ˆèŠ‚ç‚¹å°†ä¼šåœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”ä¸­å°è¯•é‡è¿

å¦å¤–ï¼Œæ‰€æœ‰è¢«åŠ¨æ¨¡å¼å¯åŠ¨çš„èŠ‚ç‚¹éƒ½ä¸ä¼šä¸»åŠ¨é€€å‡ºï¼Œè€Œæ˜¯ä¼šåŸºäºå¯åŠ¨æ—¶çš„å‚æ•°é‡æ–°ç›‘å¬åœ¨æŒ‡å®šç«¯å£ä¸Šï¼Œæ­¤æ—¶ç”¨æˆ·ä»ç„¶å¯ä»¥é€šè¿‡`connect`ã€`sshtunnel`æ¥å°†è¿™äº›èŠ‚ç‚¹è¿å›ç½‘ç»œ

### æ³¨æ„

1. **å¦‚å› ç½‘ç»œæ³¢åŠ¨æˆ–ä¸­é—´èŠ‚ç‚¹æ‰çº¿ï¼Œå¯¼è‡´æŸä¸€ä¸ªåˆ†æ”¯æ–­å¼€ï¼Œåœ¨ä¸»åŠ¨é‡è¿æ—¶è¯·åŠ¡å¿…è¿æ¥ç¼ºå¤±é“¾çš„å¤´èŠ‚ç‚¹**,ä¸¾ä¸ªä¾‹å­ï¼Œadminåæ¥ç€node1ï¼Œnode1ååˆ†ä¸ºä¸¤æ”¯ï¼Œä¸€æ”¯æ˜¯node1->node 2 -> node 3 -> node 4, ä¸€æ”¯æ˜¯node1->node 5 ->node 6ï¼Œé‚£ä¹ˆå¦‚æœnode2æ‰çº¿ï¼Œnode3åŠnode4å°†ä¸ä¼šæ‰çº¿ï¼Œè€Œæ˜¯ç»§ç»­ä¿æŒå­˜æ´»ã€‚æ­¤æ—¶ç”¨æˆ·è‹¥æƒ³å°†node3åŠnode4é‡æ–°åŠ å…¥ç½‘ç»œï¼Œé‚£ä¹ˆç”¨æˆ·æœ‰ä¸¤ç§é€‰æ‹©ï¼Œä¸€ç§æ˜¯å‡å¦‚node1å¯ä»¥ç›´æ¥è®¿é—®node3ï¼Œé‚£ä¹ˆç”¨æˆ·å¯éšæ—¶åœ¨node1å°†node3ç”¨connectæˆ–è€…sshtunnelå‘½ä»¤é‡æ–°åŠ å…¥ç½‘ç»œï¼ˆåˆ‡è®°ï¼Œå°±ç®—node1åŒæ—¶ä¹Ÿå¯ä»¥è®¿é—®node4ï¼Œä¹Ÿè¯·ä¸è¦ç›´æ¥è¿æ¥node4ï¼Œè¯·è¿æ¥æ•´ä¸ªç¼ºå¤±é“¾(node3->node4)çš„å¤´èŠ‚ç‚¹node3ï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥å°†node3åŠnode4é‡æ–°åŠ å…¥ç½‘ç»œï¼›å¦ä¸€ç§é€‰æ‹©æ˜¯å½“node1æ— æ³•ç›´æ¥è®¿é—®node3æ—¶ï¼ˆå³å¿…é¡»ç»è¿‡node2ï¼‰ï¼Œé‚£ä¹ˆè¯·å…ˆå°†node2é‡å¯å¹¶åŠ å…¥ç½‘ç»œï¼Œä¹‹åå†åœ¨node2ä¸Šä½¿ç”¨connectæˆ–è€…sshtunnelå‘½ä»¤è¿æ¥node3ï¼Œä»è€Œå°†node3åŠnode4åŠ å…¥ç½‘ç»œ

2. **å½“æœ‰èŠ‚ç‚¹æ‰çº¿æ—¶ï¼Œé‚£ä¹ˆæ­¤æ—¶ä¸æ­¤èŠ‚ç‚¹åŠå…¶å­èŠ‚ç‚¹æœ‰å…³çš„æ‰€æœ‰socksï¼Œbackwardï¼ŒforwardæœåŠ¡éƒ½ä¼šè¢«å¼ºåˆ¶åœæ­¢**

## å‘½ä»¤è§£æ

åœ¨adminæ§åˆ¶å°ä¸­ï¼Œç”¨æˆ·å¯ä»¥ç”¨tabæ¥è¡¥å…¨å‘½ä»¤ï¼Œæ–¹å‘é”®ä¸Šä¸‹å·¦å³æ¥æŸ¥æ‰¾å†å²/ç§»åŠ¨å…‰æ ‡

adminæ§åˆ¶å°åˆ†ä¸ºä¸¤ä¸ªå±‚çº§ï¼Œç¬¬ä¸€å±‚ä¸ºä¸»panelï¼ŒåŒ…å«çš„å‘½ä»¤å¦‚ä¸‹

- `help`: å±•ç¤ºä¸»panelçš„å¸®åŠ©ä¿¡æ¯

```
(admin) >> help
  help                                     		Show help information
  detail                                  		Display connected nodes' detail
  topo                                     		Display nodes' topology
  use        <id>                          		Select the target node you want to use
  exit                                     		Exit Stowaway
```

- `detail`: å±•ç¤ºåœ¨çº¿èŠ‚ç‚¹çš„è¯¦ç»†ä¿¡æ¯

```
(admin) >> detail
Node[0] -> IP: 127.0.0.1:10000  Hostname: ph4ntoms-MBP.lan  User: ph4ntom
Memo:
```

- `topo`: å±•ç¤ºåœ¨çº¿èŠ‚ç‚¹çš„çˆ¶å­å…³ç³»

```
(admin) >> topo
Node[0]'s children ->
Node[1]

Node[1]'s children ->
```

- `use`: ä½¿ç”¨æŸä¸ªagent

```
(admin) >> use 0
(node 0) >>
```

- `exit`: é€€å‡ºstowaway

```
(admin) >> exit
[*] Do you really want to exit stowaway?(y/n): y
[*] BYE!
```

å½“ç”¨æˆ·ä½¿ç”¨`use`å‘½ä»¤é€‰æ‹©äº†ä¸€ä¸ªagentåï¼Œè¿›å…¥ç¬¬äºŒå±‚node panelï¼Œå…¶åŒ…å«çš„å‘½ä»¤å¦‚ä¸‹

- `help`: å±•ç¤ºnode panelçš„å¸®åŠ©ä¿¡æ¯

```
(node 0) >> help
  help                                            Show help information
  listen                                          Start port listening on current node
  addmemo    <string>                             Add memo for current node
  delmemo                                         Delete memo of current node
  ssh        <ip:port>                            Start SSH through current node
  shell                                           Start an interactive shell on current node
  socks      <lport> [username] [pass]            Start a socks5 server
  stopsocks                                       Shut down socks services
  connect    <ip:port>                            Connect to a new node
  sshtunnel  <ip:sshport> <agent port>            Use sshtunnel to add the node into our topology
  upload     <local filename> <remote filename>   Upload file to current node
  download   <remote filename> <local filename>   Download file from current node
  forward    <lport> <ip:port>                    Forward local port to specific remote ip:port
  stopforward                                     Shut down forward services
  backward    <rport> <lport>                     Backward remote port(agent) to local port(admin)
  stopbackward                                    Shut down backward services
  shutdwon                                        Terminate current node
  back                                            Back to parent panel
  exit                                            Exit Stowaway 
```

- `listen`: å‘½ä»¤agentç›‘å¬æŸä¸ªç«¯å£å¹¶ç­‰å¾…å­èŠ‚ç‚¹çš„è¿å…¥

```
(node 0) >> listen
[*] MENTION! If you choose IPTables Reuse or SOReuse,you MUST CONFIRM that the node was initially started in the corresponding way!
[*] When you choose IPTables Reuse or SOReuse, the node will use the initial config(when node started) to reuse port!
[*] Please choose the mode(1.Normal passive / 2.IPTables Reuse / 3.SOReuse): 1
[*] Please input the [ip:]<port> : 10001
[*] Waiting for response......
[*] Node is listening on 10001
```

æ³¨æ„ï¼Œ`listen`æ˜¯æ¯”è¾ƒç‰¹æ®Šçš„ä¸€ä¸ªå‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œ`listen`å‘½ä»¤æœ‰ä¸‰ç§æ¨¡å¼

1. `Normal passive`: æ­¤é€‰é¡¹æ„å‘³ç€agentå°†ä¼šä»¥æ™®é€šçš„æ–¹å¼ç›‘å¬åœ¨ç›®æ ‡ç«¯å£ï¼Œå¹¶ç­‰å¾…å­èŠ‚ç‚¹è¿å…¥
2. `IPTables Reuse`ï¼šæ­¤é€‰é¡¹æ„å‘³ç€agentå°†ä¼šä»¥IPTables Reuseçš„æ–¹å¼å¤ç”¨ç«¯å£ï¼Œå¹¶ç­‰å¾…å­èŠ‚ç‚¹è¿å…¥
3. `SOReuse`ï¼šæ­¤é€‰é¡¹æ„å‘³ç€agentå°†ä¼šä»¥SOReuseçš„æ–¹å¼å¤ç”¨ç«¯å£ï¼Œå¹¶ç­‰å¾…å­èŠ‚ç‚¹è¿å…¥

ç¬¬ä¸€ä¸ªæ¨¡å¼æ˜¯æœ€æ™®éä½¿ç”¨çš„ï¼Œè‹¥çˆ¶èŠ‚ç‚¹ä»¥è¿™ç§æ–¹å¼ç›‘å¬ï¼Œé‚£ä¹ˆå­èŠ‚ç‚¹ä»…éœ€è¦`-c çˆ¶èŠ‚ç‚¹ip:port`å°±å¯ä»¥åŠ å…¥ç½‘ç»œ

ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªæ¨¡å¼æ˜¯æ¯”è¾ƒç‰¹æ®Šçš„ï¼Œè‹¥ç”¨æˆ·é€‰æ‹©ç¬¬äºŒæˆ–ç¬¬ä¸‰ä¸ªæ¨¡å¼ï¼Œé‚£ä¹ˆç”¨æˆ·å¿…é¡»ä¿è¯å½“å‰æ“ä½œçš„èŠ‚ç‚¹æœ¬èº«å°±æ˜¯ä»¥ç«¯å£å¤ç”¨çš„æ–¹å¼å¯åŠ¨çš„ï¼Œå¦åˆ™å°†æ— æ³•ä½¿ç”¨è¿™ä¸¤ä¸ªæ¨¡å¼

ç¬¬äºŒå’Œç¬¬ä¸‰ä¸ªæ¨¡å¼å°†ä¸éœ€è¦ç”¨æˆ·è¾“å…¥ä»»ä½•ä¿¡æ¯ï¼ŒèŠ‚ç‚¹å°†ä¼šè‡ªåŠ¨ä½¿ç”¨å…¶è‡ªèº«å¯åŠ¨æ—¶çš„å‚æ•°æ¥å¤ç”¨ç«¯å£ï¼Œå¹¶å‡†å¤‡æ¥å—å­èŠ‚ç‚¹çš„è¿æ¥

å¦å¤–ï¼Œ`listen`ä¸€æ¬¡åªèƒ½æ¥å—ä¸€ä¸ªå­èŠ‚ç‚¹çš„è¿å…¥ï¼Œè‹¥éœ€è¦å¤šä¸ªå­èŠ‚ç‚¹è¿å…¥ï¼Œè¯·æ‰§è¡Œç›¸åº”æ¬¡æ•°çš„`listen`å‘½ä»¤

- `addmemo`: ä¸ºå½“å‰èŠ‚ç‚¹æ·»åŠ å¤‡å¿˜

```
(node 0) >> addmemo test
[*] Memo added!
(node 0) >> exit
(admin) >> detail
Node[0] -> IP: 127.0.0.1:10000  Hostname: ph4ntoms-MBP.lan  User: ph4ntom
Memo:  test
```

- `delmemo`: åˆ é™¤å½“å‰èŠ‚ç‚¹çš„å¤‡å¿˜

```
(node 0) >> delmemo
[*] Memo deleted!
(node 0) >> exit
(admin) >> detail
Node[0] -> IP: 127.0.0.1:10000  Hostname: ph4ntoms-MBP.lan  User: ph4ntom
Memo:
```

- `ssh`: å‘½ä»¤èŠ‚ç‚¹ä»¥sshæ–¹å¼è¿æ¥ç›®æ ‡æœºå™¨

```
(node 0) >> ssh 127.0.0.1:22
[*] Please choose the auth method(1.username&&password / 2.certificate): 1
[*] Please enter the username: ph4ntom
[*] Please enter the password: *****
[*] Waiting for response.....
[*] Connect to target host via ssh successfully!
 # ph4ntom @ ph4ntoms-MBP in ~ ğŸ‘‘ [17:03:56]
$ whoami
ph4ntom
 # ph4ntom @ ph4ntoms-MBP in ~ ğŸ‘‘ [17:04:16]
$
```

åœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œtabé”®å°†è¢«ç¦æ­¢

- `shell`: è·å–å½“å‰èŠ‚ç‚¹çš„shell

```
(node 0) >> shell
[*] Waiting for response.....
[*] Shell is started successfully!

bash: no job control in this shell

The default interactive shell is now zsh.
To update your account to use zsh, please run `chsh -s /bin/zsh`.
For more details, please visit https://support.apple.com/kb/HT208050.
bash-3.2$ whoami
ph4ntom
bash-3.2$
```

åœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œtabé”®å°†è¢«ç¦æ­¢

- `socks`ï¼šåœ¨å½“å‰èŠ‚ç‚¹ä¸Šå¯åŠ¨socks5æœåŠ¡

```
(node 0) >> socks 7777
[*] Trying to listen on 0.0.0.0:7777......
[*] Waiting for response......
[*] Socks start successfully!
(node 0) >>
```

æ³¨æ„ä¸€ç‚¹ï¼Œæ­¤å¤„çš„7777ç«¯å£ä¸æ˜¯åœ¨agentä¸Šå¼€å¯çš„ï¼Œè€Œæ˜¯åœ¨adminä¸Šå¼€å¯

è‹¥éœ€è¦è®¾ç½®ç”¨æˆ·åå¯†ç ï¼Œå¯å°†ä¸Šæ–¹å‘½ä»¤æ”¹ä¸º`socks 7777 <your username> <your password>`

è‹¥éœ€è¦æŒ‡å®šç›‘å¬çš„æ¥å£ï¼Œå¯å°†ä¸Šæ–¹å‘½ä»¤æ”¹ä¸º`socks xxx.xxx.xxx.xxx:7777`

- `stopsocks`: åœæ­¢åœ¨å½“å‰èŠ‚ç‚¹ä¸Šçš„socks5æœåŠ¡

```
(node 0) >> stopsocks
Socks Info ---> ListenAddr: 0.0.0.0:7777    Username: <null>    Password: <null>
[*] Do you really want to shutdown socks?(yes/no): yes
[*] Closing......
[*] Socks service has been closed successfully!
(node 0) >>
```

- `connect`: å‘½ä»¤å½“å‰èŠ‚ç‚¹è¿æ¥è‡³å¦ä¸€ä¸ªå­èŠ‚ç‚¹

```
agent-1: ./stowaway_agent -l 10002
```

```
(node 0) >> connect 127.0.0.1:10002
[*] Waiting for response......
[*] New node come! Node id is 1

(node 0) >>
```

- `sshtunnel`: å‘½ä»¤å½“å‰èŠ‚ç‚¹ä»¥sshéš§é“çš„æ–¹å¼è¿æ¥è‡³å¦ä¸€ä¸ªå­èŠ‚ç‚¹

```
agent-2: ./stowaway_agent -l 10003
```

```
(node 0) >> sshtunnel 127.0.0.1:22 10003
[*] Please choose the auth method(1.username&&password / 2.certificate): 1
[*] Please enter the username: ph4ntom
[*] Please enter the password: ******
[*] Waiting for response.....
[*] New node come! Node id is 2

(node 0) >>
```

åœ¨ä¸¥æ ¼å—é™çš„ç½‘ç»œç¯å¢ƒä¸‹ï¼Œå¯ä»¥åˆ©ç”¨sshéš§é“çš„æ–¹å¼æ¥å°†stowawayçš„æµé‡ä¼ªè£…ä¸ºsshæµé‡ï¼Œä»è€Œé¿å¼€é˜²ç«å¢™çš„é™åˆ¶

- `upload`: å‘å½“å‰èŠ‚ç‚¹ä¸Šä¼ æ–‡ä»¶

```
(node 0) >> upload test.7z test.xxx
[*] File transmitting, please wait...
136.07 KiB / 136.07 KiB [-----------------------------------------------------------------------------------] 100.00% ? p/s 0s
```

- `download`: ä¸‹è½½å½“å‰èŠ‚ç‚¹ä¸Šçš„æ–‡ä»¶

```
(node 0) >> download test.xxx test.xxxx
[*] File transmitting, please wait...
136.07 KiB / 136.07 KiB [-----------------------------------------------------------------------------------] 100.00% ? p/s 0s
```

- `forward`: æ˜ å°„adminä¸Šçš„ç«¯å£è‡³è¿œç¨‹ç«¯å£

```
(node 0) >> forward 9000 127.0.0.1:22
[*] Trying to listen on 0.0.0.0:9000......
[*] Waiting for response......
[*] Forward start successfully!
(node 0) >>
```

```
$ ssh 127.0.0.1 -p 9000
Password:
 # ph4ntom @ ph4ntoms-MBP in ~ ğŸ‘‘ [17:19:51]
$
```

- `stopforward`: å…³é—­å½“å‰èŠ‚ç‚¹çš„è¿œç¨‹æ˜ å°„

```
(node 0) >> stopforward
[0] All
[1] Listening Addr : [::]:9000 , Remote Addr : 127.0.0.1:22 , Current Active Connnections : 1
[*] Do you really want to shutdown forward?(yes/no): yes
[*] Please choose one to close: 1
[*] Closing......
[*] Forward service has been closed successfully!
```

- `backward`: åå‘æ˜ å°„å½“å‰agentä¸Šçš„ç«¯å£è‡³adminçš„æœ¬åœ°ç«¯å£

```
(node 0) >> backward 9001 22
[*] Trying to ask node to listen on 0.0.0.0:9001......
[*] Waiting for response......
[*] Backward start successfully!
(node 0) >>
```

```
$ ssh 127.0.0.1 -p 9001
Password:
 # ph4ntom @ ph4ntoms-MBP in ~ ğŸŒˆ [17:22:14]
$
```

- `stopbackward`: å…³é—­å½“å‰èŠ‚ç‚¹çš„åå‘æ˜ å°„

```
(node 0) >> stopbackward
[0] All
[1] Remote Port : 9001 , Local Port : 22 , Current Active Connnections : 1
[*] Do you really want to shutdown backward?(yes/no): yes
[*] Please choose one to close: 1
[*] Closing......
[*] Backward service has been closed successfully!
```

- `shutdown`: å‘½ä»¤å½“å‰èŠ‚ç‚¹ä¸‹çº¿

```
(node 1) >> shutdown
(node 1) >>
[*] Node 1 is offline!
```

- `back`: é€€å›åˆ°ä¸»panel

```
(node 1) >> back
(admin) >>
```

- `exit`: é€€å‡ºstowaway

```
(node 1) >> exit
[*] Do you really want to exit stowaway?(y/n): y
[*] BYE!
```

## TODO

- [x] ä¿®å¤bug
- [x] æ”¯æŒTLS
- [ ] æ”¯æŒå¤šstartnodeçš„å½¢å¼

## æ³¨æ„äº‹é¡¹

- æ­¤ç¨‹åºä»…æ˜¯é—²æš‡æ—¶å¼€å‘å­¦ä¹ ï¼Œç»“æ„åŠä»£ç ç»“æ„ä¸å¤Ÿä¸¥è°¨ï¼ŒåŠŸèƒ½å¯èƒ½å­˜åœ¨bugï¼Œè¯·å¤šå¤šè°…è§£
- adminä¸åœ¨çº¿æ—¶ï¼Œæ–°èŠ‚ç‚¹å°†ä¸å…è®¸åŠ å…¥
- adminä»…æ”¯æŒä¸€ä¸ªç›´æ¥è¿æ¥çš„agentèŠ‚ç‚¹ï¼ŒagentèŠ‚ç‚¹åˆ™æ— æ­¤é™åˆ¶
- å¦‚æœç”¨æˆ·ä½¿ç”¨windowsä¸‹çš„adminç«¯ï¼Œè¯·å…ˆä¸‹è½½[ansicon](https://github.com/adoxa/ansicon/releases)ï¼Œæˆ–è€…åœ¨[è¿™é‡Œ]()ä¸‹è½½ï¼Œä¹‹åè¿›å…¥å¯¹åº”ç³»ç»Ÿä½æ•°çš„æ–‡ä»¶å¤¹ï¼Œæ‰§è¡Œ`ansicon.exe -i`å³å¯ï¼Œä¸ç„¶adminç«¯ä¼šå‡ºç°ä¹±ç çš„é—®é¢˜
- æœ¬ç¨‹åºä»…æ”¯æŒæ ‡å‡†çš„åŸºäº[RFC1928](https://www.ietf.org/rfc/rfc1928.txt)æ‰€é˜è¿°çš„`UDP ASSOCIATE`ï¼Œè¯·åœ¨ä½¿ç”¨socks5 udpä»£ç†æ—¶æ³¨æ„æ‚¨æ‰€ä½¿ç”¨çš„ç¨‹åº(ä¾‹å¦‚æ‰«æå™¨ç­‰)ï¼ŒåŒ…æ„é€ æ–¹å¼å¿…é¡»éµå®ˆæ ‡å‡†çš„[RFC1928](https://www.ietf.org/rfc/rfc1928.txt)ï¼Œå¹¶ä¸”éœ€è¦è‡ªè¡Œå¤„ç†ä¸¢åŒ…çŠ¶å†µã€‚

<!--auto_detail_active_begin_e1c6fb434b6f0baf6912c7a1934f772b-->
## é¡¹ç›®ç›¸å…³

- 2021-11-16 å‘å¸ƒæ–‡ç« [ã€ŠStowaway : ä¸“ä¸ºæ¸—é€æµ‹è¯•å·¥ä½œè€…åˆ¶ä½œçš„å¤šçº§ä»£ç†å·¥å…·ã€‹](https://mp.weixin.qq.com/s/L7Ikxd_Nql8SkezY4l0blQ)

## æœ€è¿‘æ›´æ–°

#### [v2.2] - 2024-03-29

**æ›´æ–°**  
- å°† AES-CBC åˆ‡æ¢ä¸º AES-GCM  
- ä¿®å¤ä¸€äº› bugs å’Œ æ‹¼å†™é”™è¯¯  
- ä¿®å¤å…³é—­çŸ­è¿æ¥æ—¶æ•°æ®ä¸¢å¤±çš„é”™è¯¯  
- æ·»åŠ gzipåŠŸèƒ½  
- ä¼˜åŒ–å…³é”®ä»£ç   
- æ·»åŠ httpä»£ç†æ”¯æŒ  
- å°†å‹ç¼©çš„ macOS å¯æ‰§è¡Œæ–‡ä»¶æ›¿æ¢ä¸ºæœªå‹ç¼©çš„å¯æ‰§è¡Œæ–‡ä»¶  
- å…è®¸ç®¡ç†å‘˜åœ¨æ²¡æœ‰è¿æ¥æ—¶é€€å‡º  
- ä¸ºèŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥å¯ç”¨ TLS åŠŸèƒ½  
- Socks å¯ä»¥ç›‘å¬ç‰¹å®šæ¥å£

#### [v2.1] - 2022-04-08

**æ›´æ–°**  
- ä¿®å¤å…³é—­çŸ­è¿æ¥æ—¶çš„æ•°æ®ä¸¢å¤±é”™è¯¯  
- æ·»åŠ  gzip åŠŸèƒ½  
- ä¼˜åŒ–å…³é”®ä»£ç   
- ä¿®å¤ä¸€äº› bugs

<!--auto_detail_active_end_f9cf7911015e9913b7e691a7a5878527-->
